<!DOCTYPE html>
<html lang="ja">
  <head>
    <base target="_top">
    <?!= head ?>
    <?!= commonJs ?>
    <?!= commonCss ?>
    <script>
      const baseUrl = "<?= baseUrl ?>";
    </script>
    <title>ğŸ“† ä¼‘æ¥­æ—¥</title>
    <style>
      input[type="date"],
      input[type="time"] {
        text-align: center !important;
      }

      #holiday-list-area {
        max-width: 840px;
      }

      @media (min-width: 768px) {
        #holidayTable td {
          white-space: nowrap;
          text-overflow: ellipsis;
          overflow: hidden;
        }
        #holidayTable th {
          width: auto !important;
        }
      }

      #holidayTable td:nth-child(1),  /* æ—¥ä»˜ */
      #holidayTable td:nth-child(2),  /* æ™‚é–“ */
      #holidayTable td:nth-child(3) { /* å‚™è€ƒ */
        vertical-align: middle;
      }

      /* holidayç”»é¢å°‚ç”¨ï¼šãƒ•ã‚©ãƒ¼ãƒ wrapperã‚’å°‘ã—åœ§ç¸® */
      .form-wrapper {
        padding: 0.5rem 1rem; /* â† pt-3 â†’ pt-2ç›¸å½“ */
      }
    </style>
  </head>
  <body class="container-fluid py-3 loading">
  <div id="loading" style="text-align:center; margin-top:50px;">
    <div class="auth-spinner"></div>
    <p>èªè¨¼ãƒã‚§ãƒƒã‚¯ä¸­...</p>
  </div>
  <div id="app" style="display:none;">

  <button type="button" class="btn btn-outline-secondary mb-2" onclick="goTo('40_setting_main_admin')">â† æˆ»ã‚‹</button>
  <h4 class="mb-2 text-center">ğŸ“† ä¼‘æ¥­æ—¥è¨­å®š</h4>

  <div id="loading-init" class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">èª­ã¿è¾¼ã¿ä¸­...</span>
    </div>
    <p class="mt-3">ä¼‘æ¥­æ—¥ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™â€¦</p>
  </div>

    <!-- ğŸ”„ ä¿å­˜ä¸­ãã‚‹ãã‚‹ -->
    <div id="saving-spinner" class="text-center my-3" style="display: none;">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">ä¿å­˜ä¸­...</span>
      </div>
      <p class="mt-2">ç™»éŒ²ã—ã¦ã„ã¾ã™â€¦</p>
    </div>

    <!-- ğŸ”„ å‰Šé™¤ä¸­ãã‚‹ãã‚‹ -->
    <div id="deleting-spinner" class="text-center my-3" style="display: none;">
      <div class="spinner-border text-danger" role="status">
        <span class="visually-hidden">å‰Šé™¤ä¸­...</span>
      </div>
      <p class="mt-2">å‰Šé™¤ã—ã¦ã„ã¾ã™â€¦</p>
    </div>

    <!-- âœ… å‰Šé™¤å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div id="delete-message" class="alert alert-danger text-center" style="display: none;">
      å‰Šé™¤ã—ã¾ã—ãŸï¼
    </div>


    <!-- âœ… æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div id="save-message" class="alert alert-success text-center" style="display: none;">
      ç™»éŒ²ã—ã¾ã—ãŸï¼
    </div>

  <div id="main-content">
    <div class="container-fluid px-2 mb-2" id="holiday-list-area" style="display: none;">
      <h5>ç™»éŒ²æ¸ˆã¿ã®ä¼‘æ¥­æ—¥</h5>
      <div class="table-responsive">
        <table class="table table-striped table-bordered" id="holidayTable">
          <thead>
            <tr>
              <th style="width: 32%;">æ—¥ä»˜</th>
              <th style="width: 15%;">æ™‚é–“</th>
              <th style="width: 32%;">å‚™è€ƒ</th>
              <th style="width: 23%;">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="form-wrapper mb-0">
        <button id="toggleFormBtn" class="btn btn-primary w-100 mb-0" type="button" data-bs-toggle="collapse" data-bs-target="#form-area" aria-expanded="false" aria-controls="form-area">
          ï¼‹ æ–°è¦ä½œæˆ
        </button>
      </div>
    </div>

    <div class="form-wrapper collapse mt-0" id="form-area">
    <h5 class="mb-2 mt-0">ä¼‘æ¥­æ—¥ç™»éŒ²</h5>

    <!-- ğŸ”´ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
    <div id="error-message" class="alert alert-danger" style="display: none;"></div>
      <div class="row">
        <div class="mb-3 col">
          <label for="holidayStartDate" class="form-label">é–‹å§‹æ—¥</label>
          <input type="date" class="form-control" id="holidayStartDate" onchange="syncEndDate()">
        </div>
        <div class="mb-3 col">
          <label for="holidayEndDate" class="form-label">çµ‚äº†æ—¥</label>
          <input type="date" class="form-control" id="holidayEndDate">
        </div>
      </div>
      <div class="mb-3 row">
        <div class="col">
          <label for="startTime" class="form-label">é–‹å§‹æ™‚é–“ï¼ˆä»»æ„ï¼‰
          </label>
          <input type="time" class="form-control" id="startTime">
        </div>
        <div class="col">
          <label for="endTime" class="form-label">çµ‚äº†æ™‚é–“ï¼ˆä»»æ„ï¼‰</label>
          <input type="time" class="form-control" id="endTime">
        </div>
        <small class="text-muted d-block">â€»æ™‚é–“æŒ‡å®šã¯é–‹å§‹æ—¥ï½çµ‚äº†æ—¥ã™ã¹ã¦ã«é©ç”¨ã•ã‚Œã¾ã™</small>
      </div>
      <div class="mb-3">
        <label for="note" class="form-label">å‚™è€ƒï¼ˆä»»æ„ï¼‰</label>
        <input type="text" class="form-control" id="note">
      </div>

      <div class="d-grid gap-2 mt-4">
        <button id="saveButton" class="btn btn-primary" onclick="openRegisterModal()">ç™»éŒ²</button>

      </div>

    </div>
  </div>

  <!-- âœ… ç™»éŒ²ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal fade" id="confirmRegisterModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmRegisterModalTitle">ã“ã®å†…å®¹ã§ç™»éŒ²ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="modal-body-text">
          å†…å®¹ã‚’ç¢ºèªã—ã€ã€Œç™»éŒ²ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button type="button" class="btn btn-primary" id="confirm-register-btn">ç™»éŒ²</button>
        </div>
      </div>
    </div>
  </div>

  <!-- å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ã“ã®ä¼‘æ¥­æ—¥ã‚’å‰Šé™¤ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          ä¸€åº¦å‰Šé™¤ã™ã‚‹ã¨å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button type="button" class="btn btn-danger" id="confirm-delete-btn">å‰Šé™¤ã™ã‚‹</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let deleteTargetIndex = null;
    let editingIndex = null;
    let collapseInstance = null;
    let originalHolidayData = null;

    document.addEventListener("DOMContentLoaded", () => {
      console.log("[CHILD] DOMContentLoaded â†’ child-ready ã‚’è¦ªã¸é€ä¿¡");
      try {
        window.top.postMessage(
          { type: "misemaru:child-ready", origin: location.origin },
          "*" // è¦ªå´ã§å¿…ãš event.origin ã‚’æ¤œè¨¼ã™ã‚‹ã®ã§å®‰å…¨
        );
      } catch (err) {
        console.error("[CHILD] child-ready é€ä¿¡å¤±æ•—:", err);
      }

      const btn = document.getElementById("toggleFormBtn");
      const form = document.getElementById("form-area");
      collapseInstance = new bootstrap.Collapse(form, { toggle: false });

      form.addEventListener("show.bs.collapse", () => {
        btn.textContent = "âˆ’ é–‰ã˜ã‚‹";
      });

      form.addEventListener("hide.bs.collapse", () => {
        btn.textContent = "ï¼‹ æ–°è¦ä½œæˆ";
      });

      btn.addEventListener("click", () => {
        if (form.classList.contains("show")) {
          collapseInstance.hide();
        } else {
          clearFormInputs();  // âœ… æ–°è¦ãªã‚‰åˆæœŸåŒ–
          collapseInstance.show();
          setTimeout(scrollToForm, 200);
        }
      });

      // âœ… ã“ã“ã§ãƒ•ã‚©ãƒ¼ãƒ ã® input å¤‰æ›´æ™‚ã«ãƒœã‚¿ãƒ³çŠ¶æ…‹æ›´æ–°ã™ã‚‹
      ["holidayStartDate", "holidayEndDate", "startTime", "endTime", "note"].forEach(id => {
        document.getElementById(id).addEventListener("input", updateSaveButtonState);
      });

      // âœ… æœ€åˆã¯éæ´»æ€§
      updateSaveButtonState();
    });


    window.onload = function () {
      google.script.run.withSuccessHandler(renderHolidays).getHolidayListRaw();
    };

    function renderHolidays(data) {
      window.holidayData = data;
      document.getElementById("loading-init").style.display = "none";
      document.getElementById("holiday-list-area").style.display = "block";

      const tableBody = document.querySelector("#holidayTable tbody");
      tableBody.innerHTML = "";

      if (!Array.isArray(data)) {
        tableBody.innerHTML = '<tr><td colspan="4">ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</td></tr>';
        return;
      }

      data.forEach((row, index) => {
        let dateDisplay = row.startDate === row.endDate
          ? `${row.startDate}`
          : `${row.startDate}ã€œ${row.endDate}`;

        let timeDisplay = "çµ‚æ—¥";
        if (row.start && row.end) timeDisplay = `${row.start}ã€œ${row.end}`;
        else if (row.start && !row.end) timeDisplay = `${row.start}ã€œ`;
        else if (!row.start && row.end) timeDisplay = `ã€œ${row.end}`;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${dateDisplay}</td>
          <td>${timeDisplay}</td>
          <td>${row.note || ""}</td>
          <td>
            <button class="btn btn-sm btn-warning mb-1 me-2 d-inline-block" onclick="editHoliday(${index})">ç·¨é›†</button>
            <button class="btn btn-sm btn-danger d-inline-block" onclick="openDeleteModal(${index}, '${row.startDate}', '${row.endDate}', '${row.start || ""}', '${row.end || ""}', '${row.note || ""}')">
              å‰Šé™¤
            </button>
          </td>
        `;
        tableBody.appendChild(tr);
      });

      // âœ… collapseInstance ã‚’å†å–å¾—ï¼ˆã“ã‚ŒãŒå¤§äº‹ï¼ï¼ï¼‰
      const form = document.getElementById("form-area");
      collapseInstance = bootstrap.Collapse.getOrCreateInstance(form, { toggle: false });

      // âœ… å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ åˆæœŸåŒ–
      document.getElementById("holidayStartDate").value = "";
      document.getElementById("holidayEndDate").value = "";
      document.getElementById("startTime").value = "";
      document.getElementById("endTime").value = "";
      document.getElementById("note").value = "";

      // âœ… ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‰ã˜ã¦ãŠã
      collapseInstance.hide();
    }

    window.editHoliday = function(index) {
      const row = window.holidayData[index];
      editingIndex = index;
      originalHolidayData = {
        startDate: row.startDate,
        endDate: row.endDate,
        startTime: row.start,
        endTime: row.end,
        note: row.note || ""
      };

      // ãƒœã‚¿ãƒ³æ–‡è¨€ã‚’ã€Œæ›´æ–°ã€ã«
      document.getElementById("saveButton").textContent = "æ›´æ–°";

      document.getElementById("holidayStartDate").value = row.startDate.replace(/\//g, '-');
      document.getElementById("holidayEndDate").value = row.endDate.replace(/\//g, '-');
      document.getElementById("startTime").value = row.start || "";
      document.getElementById("endTime").value = row.end || "";

      document.getElementById("note").value = row.note || "";

      if (collapseInstance) {
        collapseInstance.show();
        setTimeout(scrollToForm, 200);
      }
      updateSaveButtonState();
    };


    function syncEndDate() {
      // ç·¨é›†ä¸­ãªã‚‰ã‚¹ã‚­ãƒƒãƒ—
      if (editingIndex !== null) return;

      const startDate = document.getElementById("holidayStartDate").value;
      document.getElementById("holidayEndDate").value = startDate;
    }

    function openRegisterModal() {
      const startDate = document.getElementById("holidayStartDate").value;
      const endDate = document.getElementById("holidayEndDate").value;
      const startTime = document.getElementById("startTime").value;
      const endTime = document.getElementById("endTime").value;
      const note = document.getElementById("note").value;

      // âœ… ã‚µãƒ‹ã‚¿ã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
      if (!validateSafeInputs(note)) {
        alert("âŒ å…¥åŠ›å†…å®¹ã«ä¸æ­£ãªã‚¿ã‚°ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚");
        return;
      }

      // âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      if (!startDate) {
        showErrorMessage("é–‹å§‹æ—¥ã¯å¿…é ˆã§ã™ï¼");
        return;
      }

      if (endDate && endDate < startDate) {
        showErrorMessage("çµ‚äº†æ—¥ã¯é–‹å§‹æ—¥ã¨åŒã˜ã‹ã€ãã‚Œä»¥é™ã®æ—¥ä»˜ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚");
        return;
      }

      if (startDate === endDate && startTime && endTime && startTime >= endTime) {
        showErrorMessage("çµ‚äº†æ™‚é–“ã¯é–‹å§‹æ™‚é–“ã‚ˆã‚Šå¾Œã®æ™‚é–“ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚");
        return;
      }

      const isEdit = editingIndex !== null;

      // âœ… ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰æ›´
      const title = document.getElementById("confirmRegisterModalTitle");
      title.textContent = isEdit
        ? "ã“ã®å†…å®¹ã§æ›´æ–°ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"
        : "ã“ã®å†…å®¹ã§ç™»éŒ²ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ";

      // âœ… ãƒœã‚¿ãƒ³æ–‡è¨€ã‚‚å¤‰æ›´
      const confirmBtn = document.getElementById("confirm-register-btn");
      confirmBtn.textContent = isEdit ? "æ›´æ–°" : "ç™»éŒ²";

      // âœ… å·®åˆ†è¡¨ç¤ºç”¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
      const formatDate = (s, e) => (s === e ? s : `${s}ã€œ${e}`);
      const formatTime = (s, e) => {
        if (!s && !e) return "çµ‚æ—¥";
        if (s && e) return `${s}ã€œ${e}`;
        if (s) return `${s}ã€œ`;
        if (e) return `ã€œ${e}`;
      };

      let msg = "<ul class='list-group list-group-flush'>";

      if (isEdit && originalHolidayData) {
        const prev = originalHolidayData;

        const dateOld = formatDate(prev.startDate, prev.endDate);
        const dateNew = formatDate(startDate, endDate);

        const isTimeChanged = (prev.startTime || "") !== (startTime || "") || (prev.endTime || "") !== (endTime || "");

        const timeOldDisplay = formatTime(prev.startTime, prev.endTime);
        const timeNewDisplay = formatTime(startTime, endTime);

        const noteOld = prev.note || "-";
        const noteNew = note || "-";

        // âœ… å·®åˆ†å¼·èª¿è¡¨ç¤º
        msg += `<li class='list-group-item'>æœŸé–“ï¼š${
          dateOld !== dateNew
            ? `<span class="text-danger fw-bold">${dateOld} â†’ ${dateNew}</span>`
            : dateNew
        }</li>`;

        msg += `<li class='list-group-item'>æ™‚é–“ï¼š${
          isTimeChanged
            ? `<span class="text-danger fw-bold">${timeOldDisplay} â†’ ${timeNewDisplay}</span>`
            : timeNewDisplay
        }</li>`;

        msg += `<li class='list-group-item'>å‚™è€ƒï¼š${
          noteOld !== noteNew
            ? `<span class="text-danger fw-bold">${noteOld} â†’ ${noteNew}</span>`
            : noteNew
        }</li>`;
      } else {
        // âœ… æ–°è¦ç™»éŒ²æ™‚
        msg += `<li class='list-group-item'>æœŸé–“ï¼š${formatDate(startDate, endDate)}</li>`;
        msg += `<li class='list-group-item'>æ™‚é–“ï¼š${formatTime(startTime, endTime)}</li>`;
        msg += `<li class='list-group-item'>å‚™è€ƒï¼š${note || "-"}</li>`;
      }

      msg += "</ul>";

      document.getElementById("modal-body-text").innerHTML = msg;

      // âœ… ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
      new bootstrap.Modal(document.getElementById("confirmRegisterModal")).show();
    }



    document.getElementById("confirm-register-btn").addEventListener("click", () => {
      const modal = bootstrap.Modal.getInstance(document.getElementById("confirmRegisterModal"));
      modal.hide();
      saveHoliday();
    });

    function saveHoliday() {
      document.getElementById("saving-spinner").style.display = "block";
      document.getElementById("main-content").style.display = "none";

      const payload = {
        startDate: document.getElementById("holidayStartDate").value,
        endDate: document.getElementById("holidayEndDate").value,
        start: document.getElementById("startTime").value,
        end: document.getElementById("endTime").value,
        note: document.getElementById("note").value,
        index: editingIndex
      };

      // âœ… ã‚µãƒ‹ã‚¿ã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
      if (!validateSafeInputs(payload)) {
        alert("âŒ å…¥åŠ›å†…å®¹ã«ä¸æ­£ãªã‚¿ã‚°ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚");
        return;
      }

      google.script.run
        .withSuccessHandler(() => {
          google.script.run.withSuccessHandler(data => {
            renderHolidays(data);

            document.getElementById("saving-spinner").style.display = "none";
            document.getElementById("main-content").style.display = "block";

            // âœ… â† ã“ã“ã‚’ collapseInstance ã«çµ±ä¸€
            if (collapseInstance) {
              collapseInstance.hide();
            }

            // âœ… å…¥åŠ›åˆæœŸåŒ–ï¼ˆå¿µã®ãŸã‚2é‡ã§æ®‹ã™ï¼‰
            document.getElementById("holidayStartDate").value = "";
            document.getElementById("holidayEndDate").value = "";
            document.getElementById("startTime").value = "";
            document.getElementById("endTime").value = "";
            document.getElementById("note").value = "";

            showSaveMessage();
            editingIndex = null;
          }).getHolidayListRaw();
        })
        .saveHoliday(payload);
    }

    function showSaveMessage() {
      const msgDiv = document.getElementById("save-message");
      msgDiv.style.display = "block";
      setTimeout(() => {
        msgDiv.style.display = "none";
      }, 3000);
    }

    function clearFormInputs() {
      editingIndex = null;
      originalHolidayData = {};
      document.getElementById("holidayStartDate").value = "";
      document.getElementById("holidayEndDate").value = "";
      document.getElementById("startTime").value = "";
      document.getElementById("endTime").value = "";
      document.getElementById("note").value = "";

      updateSaveButtonState();

      document.getElementById("saveButton").textContent = "ç™»éŒ²";
    }

    function openDeleteModal(index, startDate, endDate, start, end, note) {
      deleteTargetIndex = index;

      const dateDisplay = startDate === endDate ? startDate : `${startDate}ã€œ${endDate}`;

      let timeDisplay = "çµ‚æ—¥";
      if (start && end) timeDisplay = `${start}ã€œ${end}`;
      else if (start && !end) timeDisplay = `${start}ã€œ`;
      else if (!start && end) timeDisplay = `ã€œ${end}`;

      const modal = new bootstrap.Modal(document.getElementById("deleteModal"));
      const body = document.querySelector("#deleteModal .modal-body");
      body.innerHTML = `
        <p>ä»¥ä¸‹ã®ä¼‘æ¥­æ—¥ã‚’å‰Šé™¤ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ</p>
        <ul class="list-group list-group-flush">
          <li class="list-group-item">æœŸé–“ï¼š${dateDisplay}</li>
          <li class="list-group-item">æ™‚é–“ï¼š${timeDisplay}</li>
          <li class="list-group-item">å‚™è€ƒï¼š${note || "-"}</li>
        </ul>
      `;
      modal.show();
    }

    document.getElementById("confirm-delete-btn").addEventListener("click", () => {
      const modal = bootstrap.Modal.getInstance(document.getElementById("deleteModal"));
      modal.hide();

      if (deleteTargetIndex !== null) {
        // ğŸ”„ è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        document.getElementById("deleting-spinner").style.display = "block";
        document.getElementById("delete-message").style.display = "none";
        document.getElementById("main-content").style.display = "none";

        google.script.run
          .withSuccessHandler(() => {
            // âœ… å‰Šé™¤å®Œäº†å¾Œã«ã€ä¸€è¦§ã‚’å†å–å¾—ã—ã¦åæ˜ ï¼
            google.script.run
              .withSuccessHandler(data => {
                renderHolidays(data);
                document.getElementById("deleting-spinner").style.display = "none";
                document.getElementById("main-content").style.display = "block";
                showDeleteMessage();
              })
              .getHolidayListRaw();
          })
          .deleteHoliday(deleteTargetIndex);
      }
    });

    function showDeleteMessage() {
      const msgDiv = document.getElementById("delete-message");
      msgDiv.style.display = "block";
      setTimeout(() => {
        msgDiv.style.display = "none";
      }, 3000);
    }

    function scrollToForm() {
      const form = document.getElementById("form-area");
      form.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function showErrorMessage(text) {
      const el = document.getElementById("error-message");
      el.textContent = text;
      el.style.display = "block";

      // è‡ªå‹•ã§éè¡¨ç¤ºï¼ˆ5ç§’å¾Œï¼‰
      setTimeout(() => el.style.display = "none", 5000);
    }

    function getCurrentFormData() {
      return {
        startDate: document.getElementById("holidayStartDate").value,
        endDate: document.getElementById("holidayEndDate").value,
        startTime: document.getElementById("startTime").value,
        endTime: document.getElementById("endTime").value,
        note: document.getElementById("note").value
      };
    }

    function updateSaveButtonState() {
      const saveBtn = document.getElementById("saveButton");
      const formData = getCurrentFormData();

      // æ–°è¦ or ç·¨é›†ã®åˆ¤å®š
      if (editingIndex === null) {
        // æ–°è¦ï¼š1é …ç›®ã§ã‚‚å…¥ã£ã¦ã„ã‚Œã°æ´»æ€§åŒ–
        const hasInput = Object.values(formData).some(val => val);
        saveBtn.disabled = !hasInput;
      } else {
        // ç·¨é›†ï¼šåˆæœŸãƒ‡ãƒ¼ã‚¿ã¨é•ãˆã°æ´»æ€§åŒ–
        const isChanged = JSON.stringify(formData) !== JSON.stringify(originalHolidayData);
        saveBtn.disabled = !isChanged;
      }
    }

  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </div>
  </body>
</html>