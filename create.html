<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Misemaru Cloud | Store Onboarding</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background: linear-gradient(135deg, #f5f7ff 0%, #ffffff 45%, #eef2ff 100%);
      min-height: 100vh;
      font-family: "Noto Sans JP", "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color: #1f2937;
    }
    main {
      max-width: 900px;
      margin: 0 auto;
      padding: 3.5rem 1.5rem 4.5rem;
    }
    .language-switcher {
      display: flex;
      justify-content: flex-end;
      gap: .75rem;
      align-items: center;
      margin-bottom: 2rem;
    }
    .guide-card {
      border: none;
      border-radius: 18px;
      margin-bottom: 1.75rem;
      box-shadow: 0 18px 42px rgba(15, 23, 42, .08);
      background: rgba(255,255,255,.94);
    }
    .guide-card h2 {
      font-size: 1.3rem;
      font-weight: 700;
    }
    .guide-card ul {
      margin: 0;
      padding-left: 1.1rem;
      display: grid;
      gap: .6rem;
    }
    .guide-card li {
      line-height: 1.6;
      color: #475569;
    }
    .sheet-link {
      display: inline-block;
      margin-top: 0.5rem;
      background: #2563eb;
      color: #fff !important;
      padding: 0.55rem 1rem;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      transition: background .2s;
    }
    .sheet-link:hover { background: #1e40af; }
    .support-box {
      border-radius: 16px;
      padding: 1.75rem;
      background: rgba(37, 99, 235, .08);
      color: #1d4ed8;
    }
  </style>
</head>
<body>
  <main>
    <!-- Ë®ÄË™ûÂàáÊõø -->
    <div class="language-switcher">
      <label for="createLangSelect" class="form-label mb-0" data-i18n="languageLabel">Language</label>
      <select id="createLangSelect" class="form-select form-select-sm" data-role="language-select"></select>
    </div>

    <header class="mb-4">
      <h1 class="fw-bold" data-i18n="createPageTitle">Store Onboarding Guide</h1>
      <p class="lead text-muted" data-i18n="createPageLead">Follow this checklist to prepare, deploy, and verify your Misemaru Cloud store.</p>
    </header>

    <!-- „Çπ„ÉÜ„ÉÉ„Éó1 -->
    <section class="guide-card card">
      <div class="card-body p-4">
        <h2 class="mb-3">‚ë† <span data-i18n="createStepSpreadsheet">Copy the template spreadsheet and configure script properties.</span></h2>
        <ul>
          <li data-i18n="copyStep1">Open the template below and choose ‚ÄúFile ‚Üí Make a copy‚Äù</li>
          <p class="text-muted small" data-i18n="copyStep1_note"></p>
          <li data-i18n="copyStep2">In the ‚ÄúCopy document‚Äù window, change the name freely and click ‚ÄúMake a copy‚Äù with all three boxes unchecked.</li>
          <p class="text-muted small" data-i18n="copyStep2_note"></p>
          <li data-i18n="copyStep3">A linked Apps Script project will be created automatically once the copy is made.</li>
          <p class="text-muted small" data-i18n="copyStep3_note"></p>
        </ul>
        <a id="templateLink" class="sheet-link" href="#" target="_blank" data-i18n="openTemplate">üìÑ Open Template</a>
      </div>
    </section>

    <!-- „Çπ„ÉÜ„ÉÉ„Éó2 -->
    <section class="guide-card card">
      <div class="card-body p-4">
        <h2 class="mb-3">‚ë° <span data-i18n="timezoneTitle">Set your timezone</span></h2>
        <ul>
          <li data-i18n="timezoneStep1">Open ‚ÄúExtensions ‚Üí Apps Script‚Äù.</li>
          <li data-i18n="timezoneStep2">Click the ‚öôÔ∏è icon ‚Üí Project Settings.</li>
          <li data-i18n="timezoneStep3">Set the timezone to your local region (e.g. Asia/Tokyo).</li>
        </ul>
      </div>
    </section>

    <!-- „Çπ„ÉÜ„ÉÉ„Éó3 -->
    <section class="guide-card card">
      <div class="card-body p-4">
        <h2 class="mb-3">‚ë¢ <span data-i18n="createStepDeploy">Deploy the GAS web app and note the execution URL.</span></h2>
        <ul>
          <li data-i18n="deployStep1">Click ‚ÄúDeploy ‚Üí New deployment‚Äù.</li>
          <li data-i18n="deployStep2">Select ‚ÄúWeb App‚Äù and set access to ‚ÄúAnyone (even anonymous)‚Äù.</li>
          <li data-i18n="deployStep3">Copy the generated URL (e.g. https://script.google.com/macros/s/.../exec).</li>
        </ul>
      </div>
    </section>

    <!-- „Çπ„ÉÜ„ÉÉ„Éó4 -->
    <section class="guide-card card">
      <div class="card-body p-4">
        <h2 class="mb-3">‚ë£ <span data-i18n="createStepRegistry">Submit your store info to the Misemaru registry.</span></h2>
        <ul>
          <li data-i18n="sendInfo1">Send the following details to <strong>support@misemaru.cloud</strong>:</li>
          <li data-i18n="sendInfo2">‚Ä¢ Store name<br>‚Ä¢ GAS deploy URL<br>‚Ä¢ Desired store path (e.g. /nakayama_seikotsuin)<br>‚Ä¢ Timezone</li>
          <li data-i18n="sendInfo3">You‚Äôll receive your official store URL (e.g. https://misemaru.cloud/nakayama_seikotsuin/) after verification.</li>
        </ul>
      </div>
    </section>

    <!-- „Çµ„Éù„Éº„Éà -->
    <section class="support-box mb-4">
      <h2 class="h5 fw-semibold mb-2" data-i18n="createContactTitle">Need help?</h2>
      <p class="mb-0" data-i18n="createContactBody">Reach out to support@misemaru.cloud for assistance.</p>
    </section>

    <a class="btn btn-outline-primary" href="index.html" data-i18n="backToPortal">Back to portal</a>
  </main>

  <script src="js/config.js"></script>
  <script type="module" src="js/portal.js"></script>
  
  <script>
    const SUPPORTED_LANGS = [
      { code: "ja", label: "Êó•Êú¨Ë™û" },
      { code: "en", label: "English" },
      { code: "zh-CN", label: "‰∏≠Êñá" },
      { code: "es", label: "Espa√±ol" },
      { code: "ko", label: "ÌïúÍµ≠Ïñ¥" },
    ];

    // Ë®ÄË™ûÈÅ∏ÊäûUIÁîüÊàê
    const select = document.getElementById("createLangSelect");
    SUPPORTED_LANGS.forEach(lang => {
      const opt = document.createElement("option");
      opt.value = lang.code;
      opt.textContent = lang.label;
      select.appendChild(opt);
    });

    // ÁèæÂú®„ÅÆË®ÄË™û„Çí„É≠„Éº„Éâ
    const savedLang = localStorage.getItem("mm_lang") || navigator.language || "ja";
    const currentLang = SUPPORTED_LANGS.find(l => savedLang.startsWith(l.code))?.code || "ja";
    select.value = currentLang;

    // „ÉÜ„Ç≠„Çπ„ÉàÂàá„ÇäÊõø„ÅàÈñ¢Êï∞
    function applyLanguage(lang) {
      if (typeof DICT === "undefined") {
        console.error("DICT not loaded yet");
        return;
      }
      localStorage.setItem("mm_lang", lang);
      const dict = DICT[lang] || DICT.ja;
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.dataset.i18n;
        if (dict[key]) el.innerHTML = dict[key];
      });
      document.documentElement.lang = lang;
    }

    // Ë®ÄË™ûÂ§âÊõ¥„Ç§„Éô„É≥„Éà
    select.addEventListener("change", e => applyLanguage(e.target.value));

    // ÂàùÊúüÈÅ©Áî®
    document.addEventListener("DOMContentLoaded", () => {
      applyLanguage(currentLang);
    });

    // „ÉÜ„É≥„Éó„É¨„Éº„Éà„É™„É≥„ÇØË®≠ÂÆö
    document.addEventListener("DOMContentLoaded", () => {
      const link = document.getElementById("templateLink");
      if (window.CONFIG?.TEMPLATE_SHEET_URL) {
        link.href = window.CONFIG.TEMPLATE_SHEET_URL;
      } else {
        link.textContent = "‚ö† Template URL not set";
      }
    });
  </script>
</body>
</html>